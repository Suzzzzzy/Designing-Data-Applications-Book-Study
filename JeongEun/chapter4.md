# chapter 4 부호화와 발전 


# 이야기할 내용

- api 응답으로 Base64를 사용해 텍스트로 부호화하고, Base64로 부호화했기 때문에 해석해야 한다는 것 표시한 적 있는지.
  - 저의 경험을 이야기하면, 서버에 저장된 이미지를 api로 전달할때 base64String으로 전달한 사례가 있었습니다. 
  - 그런데 따로 base64String으로 전달한다는 표시는 하지 않고, 프론트쪽에서 img tag에서 전달한 base64인코딩된 스트링을 src속성에 넣어 사용하였습니다.
  

---

# 정리

## 데이터 구조를 바이트열로 변환하는 다양한 방법

- 영향 미치는 범위
    - 효율성
    - 아키텍쳐 배포

### 순회식 업그레이드

- 대규모 애플리케이션
    - 코드 변경은 즉시 반영할 수 없어 순회식 업그레이드를 사용한다.
    - 모든 노드에 배포하지 않고 일부 노드에만 서서히 배포함으로써 새로운 버전이 원활히 실행되는지 확인한 후 모든 노드에서 실행되게 한다.
- 사용자의 업데이트에 의존하는 애플리케이션
- 순회식 업그레이드에서는 하위 호환성과 상위 호환성을 제공하는 방식으로 부호화 해야 한다.

- 하위 호환성
    - 새로운 코드가 예전 데이터를 읽을 수 있음
- 상위 호환성
    - 예전 코드가 새로운 데이터를 읽을 수 있음
    - 새 버전 코드에 의해 추가된 것을 무시할 수 있어야 하므로 다루기 더 어렵다.

## 부호화 형식과 호환성 속성

---

- 스키마리스 DB는 이전과 새로운 데이터 타입이 섞여 포함될 수 있다.
- 데이터를 파일에 쓰거나 네트워크를 통해 전송하려면 `바이트열`의 형태로 부호화해야 한다.
    - 메모리에서 사용하는 데이터 구조와는 다르다.
- 용어
    - 부호화 = 직렬화 = 마샬링
        - 인메모리 객체에서 바이트열로의 전환
        - 직렬화 : 트랜잭션 맥락에서 사용되는 직렬화와 다른 의미. 그래서 `부호화`라고 표현하기로 함.
    - 복호화 = 파싱 = 역직렬화 = 언마샬링
        - 바이트열에서 인메모리 표현으로 전환

# 언어별 형식

- 인메모리 객체를 바이트열로 부호화하는 기능 내장
    - 자바 : java.io.Serializable
- 언어에 내장된 부호화 라이브러리는 편리하지만 심각한 문제도 많다.
    - 다른 언어에서 데이터 읽기가 어렵다. 다른 시스템과 통합하는데 방해요소가 된다.
    - 복호화 과정에서 임의의 클래스를 인스턴스화 할 수 있어야 한다.
        - 보안 문제의 원인이 된다.
    - 데이터 버전 관리 등한시
    - 효율성 등한시
        - 자바의 내장 직렬화 : 성능 좋지 않고 비대해지는 부호화로 유명

# JSON, XML, 이진 변형의 문제점

- 텍스트 형식이라 갖고 있는 문제점

## 수(number)의 부호화의 애매함

1. `수`와 `숫자로 구성된 문자열` 구분할 수 없음(외부 스키마 참조 제외)
2. JSON 
    - 문자열과 수 구분
    - 그러나 정수와 부동소수점 수 구별하지 않고, 정밀도를 지정하지 않는다.
3. 큰 수를 다룰 때 문제가 된다.
    - 2^53 보다 큰 정수는 부동소수점 수를 사용하는 언어(자바스크립트 등)에서는 부정확하다.
    - `예시) 트윗식별자` 64비트 숫자 사용 → 2^53보다 큰 수 사용
        - API 에서 반환하는 JSON : 트윗ID가 `수`와 `10진 문자열` 로 2번 포함됨. → 자바스크립트에서 파싱하는 문제 해결

## 이진 문자열 지원하지 않음

- 이진 문자열 : 문자 부호화가 없는 바이트열
- 대안
    - 이진 데이터를 Base64를 사용해 텍스트로 부호화
    - Base64로 부호화했기 때문에 해석해야 한다는 것 표시
    -